enum EnrollmentStatus {
    ACTIVE
    COMPLETED
    DROPPED
    REFUNDED
    TRANSFERRED
    PENDING
}

model Enrollment {
    id String @id @default(uuid())

    // Relations
    studentId String
    student   User   @relation(fields: [studentId], references: [id])

    batchId String
    batch   Batch  @relation(fields: [batchId], references: [id])

    // Enrollment Details
    enrolledAt     DateTime         @default(now())
    status         EnrollmentStatus @default(ACTIVE)
    enrollmentType String           @default("REGULAR") // REGULAR, SCHOLARSHIP, CORPORATE, COMP

    // Payment & Pricing
    originalPrice Float
    totalFee      Float
    paidAmount    Float         @default(0)
    dueAmount     Float         @default(0)
    paymentStatus PaymentStatus @default(PENDING)

    // Discount Breakdown
    discountApplied Float?
    discountDetails Json? // [{type: "COUPON", code: "SAVE10", amount: 500}, {type: "EARLY_BIRD", amount: 300}]

    // Coupon (if applied)
    couponId String?
    coupon   Coupon? @relation(fields: [couponId], references: [id])

    // Installment (if any)
    isInstallment   Boolean @default(false)
    installmentPlan Json? // [{dueDate: "2026-02-01", amount: 2000, status: "PENDING", paidAt: null}]
    installments    Json? // payment history for installments

    // Progress Tracking
    progress       Float     @default(0)
    completedAt    DateTime?
    lastAccessedAt DateTime?

    // Attendance Summary
    totalClasses    Int          @default(0)
    attendedClasses Int          @default(0)
    attendanceRate  Float        @default(0)
    attendance      Attendance[]

    // Performance
    assignmentsSubmitted Int    @default(0)
    assignmentsTotal     Int    @default(0)
    averageMarks         Float?
    quizScores           Json?

    // ----------------------------------Certificate

    // certificateId       String?
    // certificate         Certificate? @relation(fields: [certificateId], references: [id])
    // certificateIssuedAt DateTime?
    // certificateUrl      String?

    // Feedback
    feedback            String?
    rating              Int?
    feedbackSubmittedAt DateTime?

    // Support
    supportTickets SupportTicket[]
    notes          String?

    // Audit
    createdBy String?
    updatedBy String?
    createdAt DateTime  @default(now())
    updatedAt DateTime  @updatedAt
    deletedAt DateTime? // soft delete

    // Relations (other)
    payments     Payment[]
    activityLogs ActivityLog[] // enrollment related activities

    // Unique Constraints
    @@unique([studentId, batchId])
    // Indexes for Performance
    @@index([studentId])
    @@index([batchId])
    @@index([status])
    @@index([paymentStatus])
    @@index([createdAt])
    @@index([studentId, status])
    @@index([batchId, status])
}
